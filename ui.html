<div id="Preview">
  <label id="Value">1.00</label>
  <svg id="Artboard">
    <path id="Squircle" fill="#C4C4C4" />
  </svg>
</div>
<input id="Curvature" type="range" min="0.7" max="1.3" step="0.01" value="1" />
<button id="Create">Create</button>

<script>
  document.getElementById("Curvature").oninput = onCurvatureInput;
  document.getElementById("Create").onclick = onCreateClick;
  createSquircle();

  function onCurvatureInput(e) {
    const curvature = Number(e.target.value).toFixed(2);
    document.getElementById("Value").textContent = curvature;
    createSquircle(curvature);
  }

  function onCreateClick() {
    const type = "create-squircle";
    const squircle = document.getElementById("Squircle").outerHTML;
    const pluginMessage = { type, squircle };
    parent.postMessage({ pluginMessage }, "*");
  }

  function createSquircle(curvature = 1) {
    const width = 100;
    const height = 100;
    const padding = 8;
    const svg = document.getElementById("Artboard");
    const path = createSquirclePath({ width, height, curvature });

    path.setAttribute("transform", `translate(${padding / 2}, ${padding / 2})`);
    svg.setAttribute("viewBox", `0 0 ${width + padding} ${height + padding}`);

    return svg.outerHTML;
  }

  function createSquirclePath({ width, height, curvature } = {}) {
    const path = document.getElementById("Squircle");
    const cx = width / 2;
    const cy = height / 2;
    const arc = Math.min(cx, cy) * (1 - curvature);
    const d = `
      M 0 ${cy}
      C 0 ${arc}, ${arc} 0, ${cx} 0
      S ${width} ${arc}, ${width} ${cy}, ${width - arc} ${height}
        ${cx} ${height}, 0 ${height - arc}, 0 ${cy}
    `;

    path.setAttribute("d", d);
    return path;
  }
</script>

<style>
  body {
    display: grid;
    margin: 0;
    padding: 16px;
    height: 100%;
    grid-row-gap: 8px;
    grid-template-rows: 1fr auto auto;
    box-sizing: border-box;
  }

  svg {
    height: 100%;
  }

  #Preview {
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #Value {
    position: absolute;
    font-family: sans-serif;
    font-size: 20px;
    color: white;
  }
</style>
